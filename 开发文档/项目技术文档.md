# 英语学习助手 Frontend 项目技术文档

## 📋 项目概述

**项目名称**: English Word Learning Frontend  
**技术栈**: Vue 3 + Element Plus + Pinia + Vue Router  
**后端服务**: Python Flask API (172.16.0.132:5000)  
**主要功能**: 视频字幕生成与翻译、智能学习系统、单词本管理、故事生成、用户体系、会员付费系统

## 🏗️ 项目架构

### 技术选型
- **前端框架**: Vue 3.3.8 (Composition API)
- **UI组件库**: Element Plus 2.4.2
- **状态管理**: Pinia 2.1.7
- **路由管理**: Vue Router 4.2.5
- **HTTP客户端**: Axios 1.6.2
- **视频播放**: Video.js 8.6.1
- **加密库**: Crypto-js 4.2.0
- **唯一标识**: UUID 11.1.0
- **本地数据库**: SQL.js 1.13.0
- **MCP服务器**: mcp-server 0.0.9
- **样式预处理**: Sass 1.69.5
- **构建工具**: Vue CLI 5.0

### 目录结构
```
Frontend/
├── public/                 # 公共资源
│   └── index.html         # HTML 模板
├── src/                   # 源代码目录
│   ├── assets/            # 静态资源
│   │   └── highlight.css  # 高亮样式
│   ├── components/        # 公共组件
│   │   ├── layout/        # 布局组件
│   │   │   ├── AppHeader.vue    # 应用头部
│   │   │   └── AppFooter.vue    # 应用底部
│   │   └── video/         # 视频相关组件
│   │       └── VideoPlayer.vue  # 视频播放器组件
│   ├── config/            # 配置文件
│   │   └── api.config.js  # API配置
│   ├── router/            # 路由配置
│   │   └── index.js       # 路由定义（含认证守卫）
│   ├── services/          # API服务层
│   │   └── api.js         # 统一API接口
│   ├── stores/            # Pinia状态管理
│   │   ├── authStore.js       # 用户认证状态
│   │   ├── membershipStore.js # 会员系统状态
│   │   ├── learningStore.js   # 学习功能状态
│   │   ├── userDataStore.js   # 用户数据状态
│   │   ├── wordStore.js       # 单词本状态
│   │   ├── videoStore.js      # 视频状态
│   │   └── storyStore.js      # 故事状态
│   ├── utils/             # 工具函数
│   │   ├── fileHash.js    # 文件哈希计算工具
│   │   └── apiDebugger.js # API调试工具
│   ├── views/             # 页面组件
│   │   ├── Home.vue            # 首页
│   │   ├── Login.vue           # 登录注册页
│   │   ├── UserCenter.vue      # 个人中心
│   │   ├── Membership.vue      # 会员中心
│   │   ├── VideoSubtitles.vue  # 视频字幕
│   │   ├── VideoHistory.vue    # 视频历史
│   │   ├── VideoLearning.vue   # 智能学习
│   │   ├── WordBook.vue        # 单词本
│   │   ├── BasicVocabulary.vue # 基础词库
│   │   ├── StoryGenerator.vue  # 故事生成
│   │   └── UserPermissionTest.vue # 权限测试
│   ├── App.vue            # 根组件
│   └── main.js            # 应用入口
├── 开发文档/              # 项目文档
│   ├── 项目技术文档.md       # 技术文档
│   ├── API接口文档.md        # API接口文档
│   ├── 用户体系API接口文档.md # 用户体系API文档
│   ├── 学习功能API接口文档.md # 学习功能API文档
│   └── 其他开发文档...
├── babel.config.js       # Babel 配置
├── vue.config.js         # Vue CLI 配置（含代理配置）
├── package.json          # 项目依赖和脚本
└── README.md             # 项目说明
```

## 🚀 核心功能模块

### 1. 用户认证系统 (`Login.vue` + `authStore.js`)

#### 功能描述
- 手机号验证码登录/注册
- 用户信息管理
- 会员状态检查
- 路由权限守卫
- 自动token刷新

#### 核心实现
```javascript
// 认证状态管理
export const useAuthStore = defineStore('auth', {
  state: () => ({
    user: null,
    isAuthenticated: false,
    isLoading: false,
    codeCountdown: 0
  }),
  
  getters: {
    isVip: (state) => state.user?.is_vip_active || false,
    membershipType: (state) => state.user?.membership_type || 'free',
    dailyQuotas: (state) => state.user?.daily_quotas || {}
  },
  
  actions: {
    async sendVerificationCode(phone) { /* 发送验证码 */ },
    async login(phone, verificationCode) { /* 登录 */ },
    async register(phone, verificationCode, nickname) { /* 注册 */ },
    async refreshUserInfo() { /* 刷新用户信息 */ }
  }
})

// 路由守卫
router.beforeEach((to, from, next) => {
  const authStore = useAuthStore()
  
  if (to.meta.requiresAuth && !authStore.isAuthenticated) {
    next('/login')
    return
  }
  
  if (to.meta.requiresGuest && authStore.isAuthenticated) {
    next('/')
    return
  }
  
  next()
})
```

#### 关键特性
- **手机验证码认证**: 无需密码，安全便捷
- **自动token管理**: 自动刷新和过期处理
- **权限控制**: 基于路由meta的权限验证
- **状态持久化**: 本地存储用户信息

### 2. 会员付费系统 (`Membership.vue` + `membershipStore.js`)

#### 功能描述
- 会员套餐展示与购买
- 支付宝/微信支付集成
- 订单管理与状态跟踪
- VIP权益管理
- 支付状态实时监控

#### 核心实现
```javascript
// 会员状态管理
export const useMembershipStore = defineStore('membership', {
  state: () => ({
    plans: [],
    membershipStatus: null,
    orders: [],
    currentOrder: null,
    paymentTimer: null
  }),
  
  getters: {
    isVip: (state) => state.membershipStatus?.is_vip_active || false,
    vipDaysRemaining: (state) => {
      const expireDate = new Date(state.membershipStatus?.vip_expires_at)
      const now = new Date()
      return Math.max(0, Math.ceil((expireDate - now) / (1000 * 60 * 60 * 24)))
    }
  },
  
  actions: {
    async createOrder(planId) { /* 创建订单 */ },
    async initiatePayment(orderNo, paymentMethod) { /* 发起支付 */ },
    startPaymentPolling(orderNo) { /* 轮询支付状态 */ }
  }
})
```

#### 关键特性
- **多支付方式**: 支持支付宝、微信支付
- **实时状态监控**: 轮询机制跟踪支付状态
- **订单管理**: 完整的订单生命周期管理
- **VIP权益**: 基于会员等级的功能访问控制

### 3. 智能学习系统 (`VideoLearning.vue` + `learningStore.js`)

#### 功能描述
- 基于视频的智能学习会话
- AI自动生成学习问题
- 单词记忆状态跟踪
- 学习进度统计
- 个性化学习故事生成

#### 核心实现
```javascript
// 学习状态管理
export const useLearningStore = defineStore('learning', {
  state: () => ({
    currentSession: null,
    sessionId: null,
    subtitles: [],
    questions: [],
    answers: {},
    wordMemoryStatus: {},
    learningStats: {
      questionsAnswered: 0,
      wordsReviewed: 0,
      memoryRate: 0
    }
  }),
  
  getters: {
    currentStep: (state) => {
      // 计算学习进度步骤
      if (!state.sessionId) return 0
      if (state.questions.length === 0) return 1
      if (!state.currentStory) return 2
      return 3
    },
    
    memoryRate: (state) => {
      const reviewed = Object.values(state.wordMemoryStatus)
      const remembered = reviewed.filter(status => status === true)
      return reviewed.length > 0 ? (remembered.length / reviewed.length) * 100 : 0
    }
  },
  
  actions: {
    async createSession(videoId, config) { /* 创建学习会话 */ },
    async generateQuestions(count) { /* 生成学习问题 */ },
    async submitAnswer(questionId, answer) { /* 提交答案 */ },
    async recordWordMemory(words) { /* 记录单词记忆状态 */ }
  }
})
```

#### 关键特性
- **智能问题生成**: AI基于视频内容生成相关问题
- **记忆状态跟踪**: 单词记忆效果统计
- **学习进度管理**: 多步骤学习流程
- **个性化内容**: 基于用户水平调整难度

### 4. 视频字幕生成与翻译 (`VideoSubtitles.vue`)

#### 功能描述
- 支持视频文件上传（拖拽上传 + 文件选择）
- 智能重复检测（哈希值比对，避免重复处理）
- 自动字幕生成与翻译
- 双语字幕同步显示
- 单词点击添加到单词本

#### 核心实现
```javascript
// 智能上传流程
const uploadVideo = async () => {
  // 1. 检查视频重复性
  const checkResult = await apiService.checkVideoByHash(selectedFile.value)
  
  if (checkResult.exists) {
    // 重复视频直接加载现有字幕
    const subtitleData = await apiService.getVideoSubtitles(checkResult.video_id)
    setupVideo(subtitleData)
  } else {
    // 新视频上传处理
    const response = await apiService.uploadVideo(formData)
    await checkVideoProcessingStatus(response.taskId)
    await fetchVideoSubtitles(response.videoId)
  }
}

// 字幕同步显示
const onTimeUpdate = () => {
  const currentSub = subtitles.value.find(sub => 
    currentTime.value >= sub.startTime && currentTime.value < sub.endTime
  );
  if (currentSub) {
    currentSubtitle.value = currentSub;
  }
};
```

### 5. 单词本管理 (`WordBook.vue` + `wordStore.js`)

#### 功能描述
- 单词分类管理（创建、编辑、删除分类）
- 智能单词添加（自动获取词义、音标等）
- 单词搜索与过滤
- 批量操作（移动、删除）
- 学习统计与性能分析

#### 核心实现
```javascript
// 单词状态管理
export const useWordStore = defineStore('word', {
  state: () => ({
    words: [],
    categories: [],
    isLoading: false,
    performanceStats: null
  }),
  
  actions: {
    async addWordWithInfo(wordData) {
      // 智能添加单词，自动获取详细信息
      const response = await apiService.addWordWithInfo(wordData)
      this.words.push(response.data)
      return response.data
    },
    
    async getBatchWordInfo(words) {
      // 批量获取单词信息
      return await apiService.getBatchWordInfo(words)
    },
    
    async getPerformanceStats() {
      // 获取学习统计
      const stats = await apiService.getPerformanceStats()
      this.performanceStats = stats
      return stats
    }
  }
})
```

### 6. 基础词库 (`BasicVocabulary.vue`)

#### 功能描述
- 海量基础词汇库管理
- 按难度等级分类
- 词汇覆盖率分析
- 随机单词推荐
- 批量导入功能

### 7. 故事生成 (`StoryGenerator.vue` + `storyStore.js`)

#### 功能描述
- 从单词本选择单词生成故事
- 生成中英文对照故事
- 选中单词高亮显示
- 故事保存与历史查看

### 8. 用户数据管理 (`userDataStore.js`)

#### 功能描述
- 用户专属数据隔离
- 学习统计数据
- 配额使用情况
- 用户视频管理

## 🔌 API接口定义

### 基础配置
```javascript
// api.config.js
export const BASE_URL = process.env.NODE_ENV === 'development' 
  ? '' : process.env.VUE_APP_API_URL

export const API_ENDPOINTS = {
  ROOT: '/',
  
  // 用户认证接口
  AUTH: {
    SEND_CODE: '/api/auth/send-code',
    REGISTER: '/api/auth/register',
    LOGIN: '/api/auth/login',
    PROFILE: '/api/auth/profile',
    REFRESH: '/api/auth/refresh',
    LOGOUT: '/api/auth/logout'
  },
  
  // 会员系统接口
  MEMBERSHIP: {
    PLANS: '/api/membership/plans',
    ORDERS: '/api/membership/orders',
    PAYMENTS: '/api/membership/payments',
    PAYMENT_STATUS: (orderNo) => `/api/membership/payments/${orderNo}/status`,
    STATUS: '/api/membership/status'
  },
  
  // 学习功能接口
  LEARNING: {
    CREATE_SESSION: (videoId) => `/api/learning/videos/${videoId}/learning-session`,
    GET_SUBTITLES: (sessionId) => `/api/learning/sessions/${sessionId}/subtitles`,
    GENERATE_QUESTIONS: (sessionId) => `/api/learning/sessions/${sessionId}/questions/generate`,
    SUBMIT_ANSWER: (questionId) => `/api/learning/questions/${questionId}/answer`,
    GENERATE_STORY: (sessionId) => `/api/learning/sessions/${sessionId}/story`,
    RECORD_MEMORY: (sessionId) => `/api/learning/sessions/${sessionId}/words/memory`,
    COMPLETE_SESSION: (sessionId) => `/api/learning/sessions/${sessionId}/complete`
  },
  
  // 视频相关接口
  VIDEO: {
    UPLOAD: '/api/videos/upload',
    CHECK_HASH: '/api/videos/check-hash',
    STATUS: (taskId) => `/api/videos/status/${taskId}`,
    SUBTITLES: (videoId) => `/api/videos/${videoId}/subtitles`,
    STREAM: (videoId) => `/api/videos/${videoId}/stream`
  },
  
  // 单词本接口
  WORDBOOK: {
    WORDS: '/api/words',
    WORD_INFO: (word) => `/api/words/info/${word}`,
    ADD_WITH_INFO: '/api/words/add-with-info',
    BATCH_INFO: '/api/words/batch-info',
    REFRESH_INFO: (wordId) => `/api/words/${wordId}/refresh-info`,
    PERFORMANCE_STATS: '/api/words/performance-stats',
    CATEGORIES: '/api/categories',
    MOVE_TO_CATEGORY: '/api/words/batch/move',
    BATCH_DELETE: '/api/words/batch'
  },
  
  // 基础词库接口
  BASE_WORDS: {
    STATS: '/api/base-words/stats',
    SEARCH: '/api/base-words/search',
    WORD: (word) => `/api/base-words/word/${word}`,
    COVERAGE: '/api/base-words/coverage',
    DIFFICULTY: (level) => `/api/base-words/difficulty/${level}`,
    RANDOM: '/api/base-words/random',
    BULK_IMPORT: '/api/base-words/bulk-import'
  },
  
  // 用户数据接口
  USER: {
    WORDS: '/api/user/words',
    STATISTICS: '/api/user/statistics',
    LEARNING_SESSIONS: '/api/user/learning/sessions',
    QUOTA_CHECK: '/api/user/quota/check',
    VIDEOS: '/api/user/videos',
    VIDEO_DETAIL: (videoId) => `/api/user/videos/${videoId}`,
    DELETE_VIDEO: (videoId) => `/api/user/videos/${videoId}`
  }
}
```

### HTTP客户端配置
```javascript
// api.js
const apiClient = axios.create({
  baseURL: BASE_URL,
  timeout: 120000, // 2分钟超时，适应视频上传
  headers: {
    'Content-Type': 'application/json',
    'Accept': 'application/json'
  }
})

// 请求拦截器 - 自动添加token
apiClient.interceptors.request.use(config => {
  const token = localStorage.getItem('access_token')
  if (token) {
    config.headers['Authorization'] = `Bearer ${token}`
  }
  return config
})

// 响应拦截器 - 处理401认证过期
apiClient.interceptors.response.use(
  response => response.data,
  async error => {
    if (error.response?.status === 401) {
      // 清除过期token并触发重新登录
      localStorage.removeItem('access_token')
      localStorage.removeItem('user_info')
      window.dispatchEvent(new CustomEvent('auth-expired'))
    }
    return Promise.reject(error)
  }
)
```

## 📱 状态管理

### Pinia Store 架构

#### 1. AuthStore - 用户认证状态管理
```javascript
export const useAuthStore = defineStore('auth', {
  state: () => ({
    user: null,
    isAuthenticated: false,
    isLoading: false,
    codeCountdown: 0
  }),
  
  getters: {
    isVip: (state) => state.user?.is_vip_active || false,
    membershipType: (state) => state.user?.membership_type || 'free',
    dailyQuotas: (state) => state.user?.daily_quotas || {}
  }
})
```

#### 2. MembershipStore - 会员系统状态管理
```javascript
export const useMembershipStore = defineStore('membership', {
  state: () => ({
    plans: [],
    membershipStatus: null,
    orders: [],
    paymentTimer: null
  }),
  
  getters: {
    isVip: (state) => state.membershipStatus?.is_vip_active || false,
    vipDaysRemaining: (state) => { /* 计算VIP剩余天数 */ }
  }
})
```

#### 3. LearningStore - 学习功能状态管理
```javascript
export const useLearningStore = defineStore('learning', {
  state: () => ({
    currentSession: null,
    subtitles: [],
    questions: [],
    wordMemoryStatus: {},
    learningStats: {}
  })
})
```

#### 4. UserDataStore - 用户数据状态管理
```javascript
export const useUserDataStore = defineStore('userData', {
  state: () => ({
    userWords: [],
    userVideos: [],
    statistics: null,
    quotaStatus: null
  })
})
```

#### 5. WordStore - 单词本状态管理
```javascript
export const useWordStore = defineStore('word', {
  state: () => ({
    words: [],
    categories: [],
    performanceStats: null
  })
})
```

## 🛠️ 开发配置

### 开发环境代理
```javascript
// vue.config.js
module.exports = defineConfig({
  devServer: {
    proxy: {
      '/api': {
        target: 'http://172.16.0.132:5000',
        changeOrigin: true,
        ws: true,
        proxyTimeout: 1800000, // 30分钟代理超时
        secure: false
      }
    },
    client: {
      overlay: {
        errors: true,
        warnings: false
      }
    }
  }
})
```

### 环境变量
```bash
# 开发环境
NODE_ENV=development
VUE_APP_API_URL=http://172.16.0.132:5000

# 生产环境
NODE_ENV=production
VUE_APP_API_URL=https://your-api-domain.com
```

## 🔒 安全机制

### 1. 认证与授权
- JWT Token认证
- 自动token刷新
- 路由级权限控制
- 敏感操作二次验证

### 2. 数据安全
- 用户数据隔离
- API请求加密
- 敏感信息本地加密存储
- XSS防护

### 3. 支付安全
- 第三方支付集成
- 订单状态实时验证
- 支付结果回调验证

## 📊 性能优化

### 1. 前端优化
- 组件懒加载
- 图片懒加载
- 大列表虚拟滚动
- API请求缓存

### 2. 用户体验
- 加载状态提示
- 错误边界处理
- 离线状态检测
- 响应式设计

## 🚀 新功能开发指南

### 1. 添加新页面
1. 在 `src/views/` 中创建Vue组件
2. 在 `src/router/index.js` 中添加路由
3. 配置权限meta字段
4. 在导航菜单中添加入口

### 2. 添加新的API接口
1. 在 `src/config/api.config.js` 中定义端点
2. 在 `src/services/api.js` 中实现方法
3. 添加错误处理和类型检查
4. 在对应的store中调用

### 3. 添加新的状态管理
1. 创建新的store文件
2. 定义state、getters、actions
3. 在组件中使用store
4. 处理状态持久化

## 📝 代码规范

### Vue 3 Composition API 规范
```javascript
// 推荐的组件结构
export default {
  name: 'ComponentName',
  components: { /* 子组件 */ },
  props: { /* 属性定义 */ },
  emits: ['event-name'],
  setup(props, { emit }) {
    // 1. 导入stores
    const authStore = useAuthStore()
    
    // 2. 响应式数据
    const state = ref('')
    
    // 3. 计算属性
    const computed = computed(() => {})
    
    // 4. 方法
    const method = async () => {
      try {
        const result = await apiService.someMethod()
        // 处理成功
      } catch (error) {
        ElMessage.error(`操作失败: ${error.message}`)
      }
    }
    
    // 5. 生命周期
    onMounted(async () => {
      await method()
    })
    
    // 6. 返回模板需要的内容
    return {
      state,
      computed,
      method
    }
  }
}
```

## ⚠️ 注意事项

### 1. 用户体验
- 所有异步操作显示加载状态
- 网络错误提供重试机制
- 支付流程提供明确的状态反馈

### 2. 性能考虑
- 大文件上传使用分片上传
- 视频流使用CDN加速
- 敏感操作使用防抖节流

### 3. 兼容性
- 支持现代浏览器 (Chrome 80+, Firefox 75+, Safari 13+)
- 移动端适配
- 不支持 IE 浏览器

## 🔗 相关资源

- [Vue 3 官方文档](https://vuejs.org/)
- [Element Plus 组件库](https://element-plus.org/)
- [Pinia 状态管理](https://pinia.vuejs.org/)
- [Vue Router 路由管理](https://router.vuejs.org/)
- [Axios HTTP 客户端](https://axios-http.com/)

---

## 📈 版本历史

- **v0.1.0**: 初始版本，包含基础视频字幕功能
- **v0.2.0**: 新增用户认证系统和会员付费功能
- **v0.3.0**: 新增智能学习系统和基础词库
- **v0.4.0**: 新增用户数据隔离和性能优化

---

*本文档将随着项目发展持续更新，建议定期查看最新版本。* 